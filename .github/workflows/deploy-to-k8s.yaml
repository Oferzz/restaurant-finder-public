name: Deploy to Kubernetes

on:
  push:
    paths:
      - 'k8s/**' # Trigger only on changes to the k8s folder

jobs:
  apply-kubernetes-manifests:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checkout Code
    - name: Checkout repository
      uses: actions/checkout@v3

    # Step 2: Install kubectl
    - name: Install kubectl
      run: |
        curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x kubectl
        sudo mv kubectl /usr/local/bin/

    - name: Configure kubeconfig dynamically
      run: |
        aws eks update-kubeconfig --name  retaurant-finder-cluster --region us-east-1

    # Step 4: Apply Kubernetes Manifests
    - name: Apply Kubernetes Manifests
      run: |
        kubectl apply -f k8s/deployment.yaml
        kubectl apply -f k8s/service.yaml
        kubectl apply -f k8s/ingress.yaml
